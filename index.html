
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Rome Accidents</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <link href="https://unpkg.com/tabulator-tables@6.2.1/dist/css/tabulator.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.2.1/dist/js/tabulator.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        #map { width: 1024px; height: 768px; }
        body { font: 16px/1.4 "Helvetica Neue", Arial, sans-serif; }
        .ghbtns { position: relative; top: 4px; margin-left: 5px; }
        a { color: #0077ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Rome Accidents</h1>
        <div class="row">
            <div class="col-md-12 mx-auto p-2" style="width: 1024px;"><div id="map"></div></div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div>
                    <button id="download-csv">Download CSV</button>
                    <button id="download-json">Download JSON</button>
                    <button id="download-xlsx">Download XLSX</button>
                    <button id="download-pdf">Download PDF</button>
                    <button id="download-html">Download HTML</button>
                </div>
                <div id="table"></div>
            </div>
        </div>
    </div>

<p>Built with <a href="https://github.com/Leaflet/Leaflet.heat">LeafLet Heat</a></p>
<script src="leaflet-heat.js"></script>

<script>

var map = L.map('map').setView([41.9018, 12.4921], 12);

var tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
}).addTo(map);

var heat = null;

var table = new Tabulator("#table", {
    ajaxURL:"data.json",
    maxHeight:750,
    layout:"fitDataFill", //fit columns to width of table (optional)
    resizableColumnFit:true,
    pagination:"local",
    paginationSize:10,
    paginationSizeSelector:[10, 20, 50, 100],
    movableColumns:true,
    paginationCounter:"rows",
    columns: [
        {title: "Protocol", field: "protocol", headerFilter:"input"},
        {title: "DateTime", field: "date_time", headerFilter:"input"},
        {title: "Week Day", field: "day_of_week", headerFilter:"input"},
        {title: "Type of accident", field: "type_of_accident", headerFilter:"input"},
        {title: "Longitude", field: "longitude", headerFilter:"input"},
        {title: "Latitude", field: "latitude", headerFilter:"input"},
    ],
});

function datum2latlon(datum) {
    return {lat: datum["latitude"], lon: datum["longitude"]}
}

table.on('tableBuilt', function(){

    heat = L.heatLayer(table.getData("active").map(datum2latlon)).addTo(map);

    table.on("dataFiltered", function(filters, rows){
        heat.setLatLngs(rows.map(ele => ele.getData()).map(datum2latlon));
        heat.redraw();
    });

});

//trigger download of data.csv file
document.getElementById("download-csv").addEventListener("click", function(){
    table.download("csv", "data.csv");
});

//trigger download of data.json file
document.getElementById("download-json").addEventListener("click", function(){
    table.download("json", "data.json");
});

//trigger download of data.xlsx file
document.getElementById("download-xlsx").addEventListener("click", function(){
    table.download("xlsx", "data.xlsx", {sheetName:"My Data"});
});

//trigger download of data.pdf file
document.getElementById("download-pdf").addEventListener("click", function(){
    table.download("pdf", "data.pdf", {
        orientation:"portrait", //set page orientation to portrait
        title:"Example Report", //add title to report
    });
});

//trigger download of data.html file
document.getElementById("download-html").addEventListener("click", function(){
    table.download("html", "data.html", {style:true});
});

</script>
</body>
</html>
